---
import ImageMod from "@/components/ImageMod.astro";
import config from "@/config/config.json";
import { markdownify } from "@/lib/utils/textConverter";
import type { CollectionEntry } from "astro:content";
import { getEntry } from "astro:content";
import { actions } from "astro:actions";

const { contact_form_action } = config.params;
const { hero } = (
  (await getEntry("contact", "-index")) as CollectionEntry<"contact">
).data;

// Get action result for form feedback
const result = Astro.getActionResult(actions.demo);
console.log("=== CONTACT HERO RESULT ===");
console.log("Action result:", result);
---

<section class="section">
  <div class="container">
    <div class="row">
      <div class="lg:col-6 lg:pe-20 lg:pt-16" data-aos="fade-left-sm">
        {
          hero.subtitle && (
            <p
              class="mb-2 font-medium text-tertiary"
              set:html={markdownify(hero.subtitle)}
            />
          )
        }
        {
          hero.title && (
            <h2 class="md:h1 mb-6" set:html={markdownify(hero.title)} />
          )
        }
        {
          hero.description && (
            <p
              class="text-lg/[inherit]"
              set:html={markdownify(hero.description)}
            />
          )
        }
        {
          hero.list && (
            <div class="mt-10 flex flex-col gap-10 sm:flex-row xl:mt-20">
              {hero.list.map((point) => (
                <div>
                  {point.icon && (
                    <div class="mb-3 flex h-12 w-12 items-center justify-center rounded-full bg-tertiary">
                      <ImageMod
                        class="h-6 w-6 object-cover"
                        src={point.icon}
                        alt={`icon related to ${point.title}`}
                      />
                    </div>
                  )}
                  {point.title && (
                    <h3
                      class="h6 mb-2 mt-5"
                      set:html={markdownify(point.title)}
                    />
                  )}
                  {point.description && (
                    <p
                      class="text-lg/[inherit]"
                      set:html={markdownify(point.description)}
                    />
                  )}
                </div>
              ))}
            </div>
          )
        }
      </div>
      <div
        class="relative pt-24 lg:col-6 lg:pt-16"
        data-aos="fade-left-sm"
        data-aos-delay="200"
      >
        <ImageMod
          class="absolute left-1/2 top-5 -z-10 w-20 -translate-x-1/2 lg:-top-7"
          src={"/images/logo-icon.png"}
          alt="hero image"
          loading="eager"
        />
        <div class="rounded-2xl bg-light p-5 md:p-10">
          {/* Form feedback messages */}
          {
            result?.error && (
              <div class="mb-4 rounded-lg bg-red-50 border border-red-200 p-4">
                <div class="flex">
                  <div class="flex-shrink-0">
                    <svg
                      class="h-5 w-5 text-red-400"
                      viewBox="0 0 20 20"
                      fill="currentColor"
                    >
                      <path
                        fill-rule="evenodd"
                        d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                        clip-rule="evenodd"
                      />
                    </svg>
                  </div>
                  <div class="ml-3">
                    <h3 class="text-sm font-medium text-red-800">Error</h3>
                    <div class="mt-2 text-sm text-red-700">
                      <p>{result.error.message}</p>
                    </div>
                  </div>
                </div>
              </div>
            )
          }

          {
            result?.data && (
              <div class="mb-4 rounded-lg bg-green-50 border border-green-200 p-4">
                <div class="flex">
                  <div class="flex-shrink-0">
                    <svg
                      class="h-5 w-5 text-green-400"
                      viewBox="0 0 20 20"
                      fill="currentColor"
                    >
                      <path
                        fill-rule="evenodd"
                        d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                        clip-rule="evenodd"
                      />
                    </svg>
                  </div>
                  <div class="ml-3">
                    <h3 class="text-sm font-medium text-green-800">Success!</h3>
                    <div class="mt-2 text-sm text-green-700">
                      <p>{result.data.message}</p>
                    </div>
                  </div>
                </div>
              </div>
            )
          }

          <form
            class="row g-4"
            action={actions.demo}
            method="POST"
            enctype="multipart/form-data"
          >
            <div class="col-12">
              <label for="name" class="form-label">
                Full Name <span class="text-red-500">*</span>
              </label>
              <input
                id="name"
                name="name"
                class="form-input"
                placeholder="Enter your full name"
                required
                type="text"
              />
            </div>

            <div class="col-12">
              <label for="email" class="form-label">
                Business Email <span class="text-red-500">*</span>
              </label>
              <input
                id="email"
                name="email"
                class="form-input"
                placeholder="your.email@company.com"
                required
                type="email"
              />
            </div>
            <div class="col-12">
              <label for="company-name" class="form-label">
                Company Name <span class="text-red-500">*</span>
              </label>
              <input
                id="company-name"
                name="company_name"
                class="form-input"
                placeholder="Your company name"
                required
                type="text"
              />
            </div>
            <div class="col-12">
              <label for="message" class="form-label">
                Tell us about your export compliance needs
              </label>
              <textarea
                id="message"
                name="message"
                class="form-input"
                placeholder="Describe your current export compliance challenges or what you'd like to see in the demo"
                rows="3"
              >
              </textarea>
            </div>
            <div class="col-12">
              <button type="submit" class="btn btn-regular">
                Request Demo
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</section>
